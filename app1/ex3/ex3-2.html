<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JRostand stade reperes</title>
    <link rel="stylesheet" type="text/css" href="./style.css" />
</head>
<body>

    <h1>JRostand Reperes Stade</h1>
    <hr>
    <div id="map">...</div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA7Y32T_PJHZxYcK3BJYJFNwSl6cuvLXpo&callback=loadDoc&v=weekly" defer></script>
    <script>

        var markers;

        // when page is API google maps is complete, process for the map!
        // Fetch au lieu de Ajax
        function loadDoc() {
            fetch("markersJrostand.json")
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur réseau');
                    }
                    return response.json();
                })
                .then(markers => {
                    // TODO4 :
                    /* markers representera un objet JSON retourné par le serveur */
                    /*
                        compléter le code de la fonction afin d'afficher les chaque coordonnée  à la console
                    */

                    /*
                        vous utiliserez deux boucles for
                        - boucle for classique sur markers
                        - boucle for in sur marker
                     */
                    for(let i = 0; i < markers.length; i++){
                        let marker = markers[i];
                        for(key in marker){
                            console.log(key + ": " + marker[key]);
                        }
                        console.log("____________");
                    }

                    /*
                        Créer des markers Google avec l'API Google Maps en utilisant l'objet renvoyé par
                        le serveur web. Afficher votre map.
                     */
                    initMap(markers);
                    // fin  TODO4
                })
                .catch(error => {
                    console.error('Erreur:', error);
                });
        };

        function initMap(markers) {
            var map = new google.maps.Map(document.getElementById("map"), {
                center: new google.maps.LatLng(48.95930033308523, 2.5477890651742516),
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            /*****   Markers  *****/

            // Tableau pour stocker les positions des marqueurs
            var markerPositions = [];

            for (let i = 0; i < markers.length; i++) {
                let latlng = new google.maps.LatLng(markers[i].lat, markers[i].lng);
                markerPositions.push(latlng);
                
                let marker = new google.maps.Marker({
                    position: latlng,
                    map: map
                });

                google.maps.event.addListener(marker, 'click', function() {
                    alert("Tu as cliqué sur le marqueur !");
                });
            }

            /**** Polylines *****/
            const flightPath = new google.maps.Polyline({
                path: markerPositions,
                geodesic: true,
                strokeColor: "#FF0000",
                strokeOpacity: 1.0,
                strokeWeight: 2,
            });
            flightPath.setMap(map);
        }

    </script>

</body>
</html>